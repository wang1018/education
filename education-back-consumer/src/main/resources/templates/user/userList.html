<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>用户列表</title>
    <link rel="stylesheet" href="../layui/css/layui.css" media="all">

</head>
<body style="overflow-y: hidden">
    <blockquote class="layui-elem-quote news_search">
        <div class="layui-inline">
            <div class="layui-input-inline">
                <input type="text" value="" placeholder="请输入关键字" class="layui-input search_input">
            </div>
            <a class="layui-btn search_btn">查询</a>
        </div>
        <div class="layui-inline">
            <a class="layui-btn layui-btn-normal newsAdd_btn">添加文章</a>
        </div>
        <div class="layui-inline">
            <a class="layui-btn layui-btn-danger batchDel">批量删除</a>
        </div>
    </blockquote>

    <table class="layui-hide" id="demo" lay-filter="test"></table>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">新增</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit" >编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<div class="layui-tab-item">
    <div id="pageDemo"></div>
</div>
<script src="../layui/layui.js"></script>
<script src="../layui/lay/modules/laypage.js"></script>
<script src="../js/jquery-1.9.1.min.js"></script>
<script>

    layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element', 'slider'], function(){
        var laydate = layui.laydate //日期
            ,laypage = layui.laypage //分页
            ,layer = layui.layer //弹层
            ,table = layui.table //表格
            ,carousel = layui.carousel //轮播
            ,upload = layui.upload //上传
            ,element = layui.element //元素操作
            ,slider = layui.slider //滑块

        //第一个实例
        table.render({
            elem: '#demo'
            ,height: 500
            ,url: '../user/queryUserListAndLimit' //数据接口
            ,method:'post'
            ,page: true //开启分页
            ,toolbar: 'default' //开启工具栏，此处显示默认图标，可以自定义模板，详见文档
            ,totalRow: true //开启合计行

            ,cols: [
                [ //表头
                    {type: 'checkbox', fixed: 'left'},
                    {field:'userName', width:80, title: '用户姓名',sort:true,width:200}
                    ,{field:'loginNumber', width:80, title: '登录帐号',width:200}
                    ,{field:'password', width:80, title: '登录密码',width:200}
                    ,{fixed: 'right',title: '操作', width: 200, align:'center', toolbar: '#barDemo'}
                ]
            ]
        });
    //分页
        laypage.render({
            elem:'pageDemo'
            ,count:'count'
            ,curr:'page'
            ,limit:'limit'
            ,layout: ['prev', 'page', 'next', 'skip','count','limit']
            ,jump:function (obj,first) {
                if(!first){
                    curnum = obj.curr;
                    limitcount = obj.limit;
                    //console.log("curnum"+curnum);
                    //console.log("limitcount"+limitcount);
                    //layer.msg(curnum+"-"+limitcount);
                    productsearch(productGroupId,curnum,limitcount);
                }
            }
        })


    });

    layui.use('table', function(){
        var table = layui.table;
        //监听表格复选框选择
        table.on('checkbox(demo)', function(obj){
            console.log(obj)
        });
        //监听工具条
        table.on('tool(test)', function(obj){
            var data = obj.data;
            var userId = data.userId;
            if(obj.event === 'detail'){
                layer.open({
                    type: 2,
                    title: '新增',
                    shadeClose: false, //点击遮罩关闭
                    shade: 0.8,
                    area: ['50%', '50%'],
                    maxmin: true,
                    closeBtn: 1,
                    content: ['/user/toAddUser', 'yes'], //iframe的url，yes是否有滚动条
                    end: function () {
                        location.reload();
                    }

                });
            }else if(obj.event === 'del'){
                layer.confirm('真的删除行么', function(index){
                    obj.del();
                    $.ajax({
                        url:'/user/deleteUser',
                        data:{
                            userId:userId
                        },
                        dataType:'json',
                        type:'post',
                        success:function(){
                            layer.close(index);
                        }
                    })
                });
            }else if(obj.event === 'edit'){/*'编辑行：<br>'+ JSON.stringify(data)*/

                    layer.open({
                        type: 2,
                        title: '修改',
                        shadeClose: false, //点击遮罩关闭
                        shade: 0.8,
                        area: ['50%', '50%'],
                        maxmin: true,
                        closeBtn: 1,
                        content: ['/user/toEditUser?userId='+userId, 'yes'], //iframe的url，yes是否有滚动条
                        end: function () {
                            layer.open({
                                type: 2,
                                title: '修改',
                                shadeClose: false, //点击遮罩关闭
                                shade: 0.8,
                                area: ['50%', '50%'],
                                maxmin: true,
                                closeBtn: 1,
                                content: ['/user/toEditUser?userId='+userId, 'yes'], //iframe的url，yes是否有滚动条
                                end: function () {
                                    location.reload();
                                }

                            });
                        }

                    });
                }


        })

    });

    function reloadData(){
        location.reload();
    }




</script>
</body>
</html>
